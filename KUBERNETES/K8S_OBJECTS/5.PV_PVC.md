#  PV and PVC

## 📌 Notes
1. You need to **manually create an EBS volume** in AWS, get the **VolumeID**, and update it in the PersistentVolume (PV) manifest.  
2. The EBS volume must be created in the **same region and Availability Zone as your EC2 worker nodes**.  
3. **EBS integrates with PV** and the **Pod connects to the PVC**, which in turn binds to the PV.  

## 🗂 PersistentVolume (PV) Manifest
```yaml
apiVersion: v1
kind: PersistentVolume
metadata:
  name: my-pv
  labels:
    name: my-pv       # Add a label so PVC can match it
spec:
  capacity:
    storage: 20Gi                      
  volumeMode: Filesystem
  accessModes:
    - ReadWriteOnce                   
  awsElasticBlockStore:
    volumeID: <EBS-volume-ID>    # Replace with your actual EBS volume ID
    fsType: ext4                      
  persistentVolumeReclaimPolicy: Retain  
````

## 🗂 PersistentVolumeClaim (PVC) Manifest
```yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: my-pvc
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 2Gi
  storageClassName: ""              # Explicitly empty for static PV binding
  selector:
    matchLabels:
      name: my-pv                   # Must match the PV label
```
## 📦 Pod (with PVC)
```yaml
apiVersion: v1
kind: Pod
metadata:
  name: my-pod1
spec:
  containers:
  - name: container1
    image: httpd:latest
    volumeMounts:
      - name: my-volume
        mountPath: /data
  volumes:
    - name: my-volume
      persistentVolumeClaim:
        claimName: my-pvc             #(paste your pvc name here)
```

## ⚡ Commands

```bash
# Create the PV
kubectl apply -f pv.yml

# Create the PVC
kubectl apply -f pvc.yml

# Verify status
kubectl get pv,pvc
```

✅ If the configuration is correct, the PVC will be in **Bound** state with the PV.

---

## 📝 Important

* `persistentVolumeReclaimPolicy: Retain` ensures that the EBS volume is **not deleted** automatically when the PV/PVC is deleted.
* If you want Kubernetes to clean up the volume after deletion, set it to `Delete`.
* Always ensure **AZ alignment** between the EBS and your EC2 node group, otherwise the Pod will remain stuck in `ContainerCreating`.
