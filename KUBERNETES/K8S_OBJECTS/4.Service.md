# ğŸ›°ï¸ SERVICE
## ğŸ“Œ Tips for using Service Manifest

1. To use a **Service**, you must define:
   - `type`
   - `selector`
   - `ports`  
   _(Think of it as the **TSP ("The Service Provider")** under `spec`)_
2. Always match `selector` with Deploymentâ€™s pod `labels`
3. `port` = Service port; `targetPort` = Podâ€™s port; `NodePort` = Node (EC2) port

## ğŸ”¹ Service - NodePort

```yaml
apiVersion: v1
kind: Service
metadata:
  name: my-service
spec:
  type: NodePort
  selector:
    name: my-pod1
  ports:
    - protocol: TCP
      port: 80             # Service Port     
      targetPort: 80       # Pod Port
      NodePort: 31000      # Node Port (30,000 - 32,767)
````

## ğŸ”¹ Deployment
```yaml
# Static webapp
apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-deployment
spec:
  replicas: 3
  selector:
    matchLabels:
      name: my-pod1
  template:
    metadata:
      labels:
        name: my-pod1
    spec:
      containers:
      - name: container1
        image: pandacloud/webapp3
```
## ğŸ”¹ Apply the Manifests

```bash
kubectl apply -f service.yaml
```
```bash
kubectl apply -f deploy.yaml
```
Check if the service is created:

```bash
kubectl get svc
```

Sample Output:

```
NAME         TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)        AGE
my-service   NodePort    10.96.10.134   <none>        80:31892/TCP   1m
```

## ğŸ”¹ Test Service

1. On EKS or Kubernetes cluster:

   ```bash
   curl localhost:<nodeport>
   ```

2. From Browser:
   ğŸ‘‰ Open `http://<EC2-Node-PublicIP>:<NodePort>`

   âœ… You should see your app running.

## ğŸ”¹ Important Notes

1. `ClusterIP` gets **automatically created** along with NodePort.

   * Used for internal cluster communication.
   * Default behavior.

2. To verify the service:

   ```bash
   kubectl describe svc my-service
   ```


## ğŸ”¹ Service - LoadBalancer

```yaml
apiVersion: v1
kind: Service
metadata:
  name: my-service
spec:
  type: LoadBalancer
  selector:
    name: my-pod1
  ports:
    - protocol: TCP
      port: 80             # Service Port     
      targetPort: 80       # Pod Port
````
## ğŸ”¹ Apply Service Manifest

```bash
kubectl apply -f service.yaml
```

Check if the service is created:

```bash
kubectl get svc
```

Sample Output:

```
NAME         TYPE            CLUSTER-IP     EXTERNAL-IP   PORT(S)        AGE
my-service   LoadBalancer    10.96.10.134   <ALB-LB-DNS>  80:31892/TCP   1m
```

## ğŸ”¹ Test Service

1. On EKS or Kubernetes cluster:

   ```bash
   curl <ALB-LB-DNS>
   ```

2. From Browser:
   ğŸ‘‰ Open `http://<ALB-LB-DNS>`

   âœ… You should see your app running.

## ğŸ“ Summary

* **Deployment** creates pods.
* **Service** exposes pods inside/outside the cluster.
* Use `T, S, P` rule: **type, selector, ports**.
* For external access: `NodePort` or `LoadBalancer`.

## ğŸ”¹ For Minikube Users (Optional)

1. Open a separate terminal and run:

   ```bash
   minikube tunnel
   ```

   This will allow external networking.

2. Then test:

   ```bash
   curl <NodePort-IP>
   ```


