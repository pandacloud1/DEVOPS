# 🗄️ STATEFULSET
## 🔹 StatefulSet Manifest

```yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: my-statefulset
spec:
  replicas: 3
  serviceName: "my-service"
  selector:
    matchLabels:
      name: my-pod1
  template:
    metadata:
      labels:
        name: my-pod1
    spec:
      containers:
      - name: container1
        image: pandacloud/webapp3:latest    # Same image as Deployment
        ports:
        - containerPort: 80                 # Same as Deployment
        volumeMounts:
        - name: data-storage
          mountPath: /data
  volumeClaimTemplates:
  - metadata:
      name: data-storage
    spec:
      accessModes: [ "ReadWriteOnce" ]
      resources:
        requests:
          storage: 1Gi
````

## 🔹 Key Points

1. **replicas: 3** → Creates 3 pods with **unique names**:
   `my-statefulset-0`, `my-statefulset-1`, `my-statefulset-2`

2. **serviceName: "my-service"**

   * Must be a **Headless Service** (`clusterIP: None`) for stable network IDs.
   * Each pod gets a **stable DNS name**, e.g. `my-statefulset-0.my-service`.

3. **Persistent Volumes (PV/PVCs):**

   * Uses `volumeClaimTemplates` to automatically create PVCs.
   * Each pod gets its **own volume**, ensuring data is not shared across replicas.
   * Example PVCs:

     ```
     data-storage-my-statefulset-0
     data-storage-my-statefulset-1
     data-storage-my-statefulset-2
     ```

4. **Use Cases:**

   * Databases (MySQL, MongoDB, Cassandra)
   * Distributed systems (Kafka, Zookeeper)
   * Applications needing stable **storage + identity**

## 🔹 Commands
### Apply the StatefulSet

```bash
kubectl apply -f statefulset.yaml
```

### Verify Pods

```bash
kubectl get pods -l name=my-pod1
```

Expected output:

```
NAME                READY   STATUS    RESTARTS   AGE
my-statefulset-0    1/1     Running   0          1m
my-statefulset-1    1/1     Running   0          1m
my-statefulset-2    1/1     Running   0          1m
```

### Check Persistent Volume Claims

```bash
kubectl get pvc
```

### Delete StatefulSet (without deleting PVCs)

```bash
kubectl delete statefulset my-statefulset
```

### Cleanup PVCs (if needed)

```bash
kubectl delete pvc -l app=my-statefulset
```

## 🔹 Notes
* **Deployment vs StatefulSet:**

  * Deployment → Stateless apps (web servers, APIs)
  * StatefulSet → Stateful apps (databases, storage systems)
  * **Provides Stable Pod IDs** (`-0`, `-1`, `-2`)
  * **Provides Stable Storage** via PVCs
  * **Provides ordered deployment & scaling** (pods start/terminate in sequence)
