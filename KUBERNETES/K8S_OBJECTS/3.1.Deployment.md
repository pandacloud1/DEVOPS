# 🚀 DEPLOYMENT

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-deployment
spec:
  replicas: 3
  selector:
    matchLabels:
      name: my-pod1
  template:
    metadata:
      labels:
        name: my-pod1
    spec:
      containers:
      - name: container1
        image: nginx:1.19.0  # Old version
        ports:
        - containerPort: 80
````

## Deployment Lifecycle Diagram

```plaintext

         ┌───────────────────┐
         │  Deployment       │
         └───────┬───────────┘
                 │ creates
                 ▼
         ┌───────────────────┐
         │   ReplicaSets     │
         └───────┬───────────┘
                 │ creates
                 ▼
         ┌───────────────────┐
         │       Pods        │
         └───────────────────┘
```

## Commands & Sample Outputs

### 1️⃣ Create the Deployment

```bash
kubectl apply -f deploy.yaml
```

**Output:**

```
deployment.apps/my-deployment created
```

### 2️⃣ View Deployments

```bash
kubectl get deploy
```

**Output:**

```
NAME            READY   UP-TO-DATE   AVAILABLE   AGE
my-deployment   3/3     3            3           10s
```

### 3️⃣ Rollout History

```bash
kubectl rollout history deployment my-deployment
```

**Output:**

```
deployment.apps/my-deployment 
REVISION  CHANGE-CAUSE
1         Initial deployment - nginx:1.19.0
```

### 4️⃣ Update the Deployment

```bash
kubectl edit deployment my-deployment
```

Change:

```yaml
image: nginx:1.19.0
```

to:

```yaml
image: nginx:1.20.0
```

Add:

```yaml
metadata:
  annotations:
    kubernetes.io/change-cause: "v1.20 update"
```

### 5️⃣ Verify Update

```bash
kubectl get pods -o wide
```

**Output:**

```
NAME                             READY   STATUS    RESTARTS   AGE     IP           NODE
my-deployment-6d7fbc8d8b-lf4c5   1/1     Running   0          20s     10.1.0.15    node1
my-deployment-6d7fbc8d8b-znk8t   1/1     Running   0          20s     10.1.0.16    node1
my-deployment-6d7fbc8d8b-wj8sz   1/1     Running   0          20s     10.1.0.17    node2
```

### 6️⃣ Rollback

```bash
kubectl rollout undo deployment my-deployment --to-revision=1
```

**Output:**

```
deployment.apps/my-deployment rolled back
```

### Rollout & Rollback Flow

```plaintext
   Initial Deploy
        │
        ▼
   Version 1 (nginx:1.19.0)
        │
        │  Edit YAML → Apply
        ▼
   Version 2 (nginx:1.20.0)
        │
        │  If issues found
        ▼
 Rollback Command → Back to Version 1
```

## Example Use Cases

* Hosting stateless applications like **NGINX**, **Apache**
* Rolling updates with zero downtime
* Managing scalable web applications
  
## Notes

1. No need to maintain separate YAML files for rollout/rollback; Kubernetes keeps deployment history.
2. A Deployment **cannot** expose pods to the outside world — use a **Service** for that.
3. Deployment is ideal for **stateless applications** (e.g., web servers).
   For **stateful applications** (e.g., databases), use **StatefulSet**, combine them with **PV/PVC**.

